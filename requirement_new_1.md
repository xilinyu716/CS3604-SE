# 12306铁路票务系统 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 项目背景
复刻中国铁路12306官方网站的核心功能，提供在线火车票查询、预订、购买等服务。

### 1.2 项目目标
构建一个功能完整的铁路票务系统，包含用户注册登录、车票查询、订单管理、个人中心等核心模块。

### 1.3 目标用户
- 需要购买火车票的普通用户
- 学生群体（需要购买学生票）
- 经常出行的商务人士

## 2. 功能模块

### 2.1 首页/查询页 (https://www.12306.cn/index/index.html)

#### 2.1.1 界面需求
- **导航栏**
  - 注册按钮：用户注册入口
  - 登录按钮：用户登录入口
  - 我的12306：个人中心入口
  - 车票：车票查询入口

- **查询表单**
  - 出发地输入框：支持城市/车站搜索
  - 目的地输入框：支持城市/车站搜索
  - 日期选择器：选择出发日期
  - 学生票复选框：区分学生票和成人票
  - 往返选项：支持往返票查询
  - 查询按钮：发起车票查询

#### 2.1.2 用户流程

**用户进入注册/登录页面**
```gherkin
Scenario: 成功跳转
    Given 用户在首页/查询页
    When 用户点击"注册"或"登录"按钮
    Then 跳转至注册/登录页面
```

**用户进行车票查询**
```gherkin
Scenario: 输入查询条件
    Given 用户位于首页/查询页
    When 用户在输入框中填写出发地、目的地和出发日期
    Then 系统校验输入格式合法且完整，允许用户点击"查询"按钮

Scenario: 发起查询请求
    Given 用户已正确填写出发地、目的地和出发日期
    When 用户点击"查询"按钮
    Then 系统显示"正在查询，请稍候…"并向后端发送查询请求

Scenario: 成功查询车票
    Given 用户发起查询请求
    When 系统成功接收到后端返回的车次信息
    Then 前端显示查询结果列表，包括车次、时间、票价、余票等信息

Scenario: 查询条件不完整
    Given 用户未填写完整的查询条件
    When 用户点击"查询"按钮
    Then 系统弹出提示信息"请填写完整的查询条件"，并高亮缺失字段

Scenario: 无匹配车次
    Given 用户填写完整查询条件
    And 后端查询结果为空
    When 系统返回空结果
    Then 前端显示提示"暂无符合条件的车次，请更换条件重试"
    And 前端不显示查询结果列表

Scenario: 查询失败（网络异常）
    Given 用户发起了有效查询请求
    And 系统无法连接后端或响应超时
    When 查询失败
    Then 系统提示"网络异常，请稍后重试"，并提供"重试"按钮
    And 前端不显示查询结果列表

Scenario: 查询学生票
    Given 用户在首页/查询页
    When 用户勾选"学生"复选框并填写查询信息
    Then 系统在查询时会只查询学生票
```

**用户进入个人中心**
```gherkin
Scenario: 成功跳转
    Given 用户在首页/查询页
    When 用户点击"我的12306"按钮
    Then 跳转至个人中心页面
```

**用户进入车票查询**
```gherkin
Scenario: 成功跳转
    Given 用户在首页/查询页
    When 用户点击"车票"按钮
    Then 跳转至车次列表页
```

### 2.2 登录/注册页 (https://kyfw.12306.cn/otn/resources/login.html)

#### 2.2.1 界面需求
- **登录表单**
  - 用户名/手机号输入框
  - 密码输入框
  - 验证码输入框
  - 登录按钮

- **注册入口**
  - 手机号注册选项
  - 邮箱注册选项

- **辅助功能**
  - 忘记密码链接

#### 2.2.2 用户流程

**用户登录**
```gherkin
Scenario: 成功登录
    Given 用户在登录/注册页
    When 用户输入正确的用户名/手机号和密码
    And 点击"登录"按钮
    Then 系统验证通过，跳转到首页/查询页或个人中心

Scenario: 登录失败
    Given 用户在登录/注册页
    When 用户输入错误的用户名/手机号或密码
    And 点击"登录"按钮
    Then 系统提示"用户名或密码错误"
```

**用户注册**
```gherkin
Scenario: 进入手机号注册流程
    Given 用户在登录/注册页
    When 用户点击"手机号注册"
    Then 跳转到手机号注册页面，要求输入手机号、密码、确认密码和短信验证码

Scenario: 进入邮箱注册流程
    Given 用户在登录/注册页
    When 用户点击"邮箱注册"
    Then 跳转到邮箱注册页面，要求输入邮箱、密码、确认密码和邮箱验证码
```

**密码找回**
```gherkin
Scenario: 进入密码找回流程
    Given 用户在登录/注册页
    When 用户点击"忘记密码"
    Then 跳转到密码找回页面，提供通过手机号或邮箱找回密码的选项
```

### 2.3 车次列表页 (https://kyfw.12306.cn/otn/leftTicket/init?linktypeid=dc)

#### 2.3.1 界面需求
- **查询条件展示区**
  - 出发地、目的地、日期显示
  - 修改查询条件按钮

- **筛选条件**
  - 车次类型筛选（高铁、动车、普通）
  - 车站筛选（出发/到达车站）
  - 席别筛选（商务座、一等座、二等座）

- **车次列表**
  - 车次编号、出发时间、到达时间、历时
  - 各席别票价和余票数量
  - 排序选项（出发时间、历时）

- **日期导航**
  - 前一天按钮
  - 后一天按钮

#### 2.3.2 用户流程

**用户筛选车次**
```gherkin
Scenario: 按车次类型筛选
    Given 用户在车次列表页
    When 用户选择一个或多个车次类型（如高铁、动车、普通）
    Then 列表只显示符合选定车次类型的车次

Scenario: 按车站筛选
    Given 用户在车次列表页
    When 用户选择一个或多个出发/到达车站
    Then 列表只显示在选定车站停靠的车次

Scenario: 按席别筛选
    Given 用户在车次列表页
    When 用户选择一个或多个席别（如商务座、一等座、二等座）
    Then 列表只显示有符合选定席别余票的车次
```

**用户排序车次**
```gherkin
Scenario: 按出发时间升序排序
    Given 用户在车次列表页
    When 用户点击"出发时间"列标题
    Then 车次列表按出发时间从早到晚排序

Scenario: 按历时升序排序
    Given 用户在车次列表页
    When 用户点击"历时"列标题
    Then 车次列表按历时从短到长排序
```

**用户预订车票**
```gherkin
Scenario: 进入订单填写页
    Given 用户在车次列表页
    When 用户点击某个车次后的"预订"按钮
    Then 跳转到订单填写页，并带入所选车次信息
```

### 2.4 订单填写页 (https://kyfw.12306.cn/otn/confirmPassenger/initDc)

#### 2.4.1 界面需求
- **列车信息**
  - 车次编号、出发地、目的地
  - 出发时间、到达时间、历时

- **乘客信息**
  - 常用联系人列表
  - 添加新乘客按钮

- **购票信息**
  - 票种选择（成人票、儿童票、学生票）
  - 席别选择（商务座、一等座、二等座）
  - 乘客姓名、身份证号

- **操作按钮**
  - 提交订单按钮
  - 返回按钮

#### 2.4.2 用户流程

**用户选择乘客**
```gherkin
Scenario: 选择已有乘客
    Given 用户在订单填写页
    When 用户勾选一个或多个常用联系人
    Then 乘客信息自动填充到购票信息区域

Scenario: 添加新乘客
    Given 用户在订单填写页
    When 用户点击"添加新乘客"
    Then 弹出表单，要求输入新乘客的姓名、身份证号、手机号等信息
```

**用户选择席别和票种**
```gherkin
Scenario: 选择席别
    Given 用户已选择乘客
    When 用户为乘客选择席别（如商务座、一等座、二等座）
    Then 系统更新订单总价

Scenario: 选择票种
    Given 用户已选择乘客
    When 用户为乘客选择票种（如成人票、儿童票、学生票）
    Then 系统更新订单总价
```

**用户提交订单**
```gherkin
Scenario: 成功提交订单
    Given 用户已完整填写订单信息
    When 用户点击"提交订单"按钮
    Then 系统进入支付页面，并锁定座位

Scenario: 订单信息不完整
    Given 用户未选择乘客或未选择席别
    When 用户点击"提交订单"按钮
    Then 系统提示"请完善订单信息"
```

### 2.5 个人中心 (https://kyfw.12306.cn/otn/view/index.html)

#### 2.5.1 界面需求
- **用户基本信息**
  - 姓名、身份证号、手机号
  - 会员等级、积分信息

- **乘客管理**
  - 常用乘客列表
  - 添加乘客按钮
  - 编辑/删除操作

- **订单管理**
  - 未出行订单
  - 历史订单
  - 订单详情查看

- **账户设置**
  - 修改密码入口
  - 退出登录

#### 2.5.2 用户流程

**用户管理乘客信息**
```gherkin
Scenario: 添加新乘客
    Given 用户在个人中心
    When 用户点击"添加乘客"并填写信息
    Then 新乘客信息被保存

Scenario: 编辑乘客信息
    Given 用户在个人中心
    When 用户选择一个乘客并点击"编辑"
    Then 可以修改乘客信息

Scenario: 删除乘客
    Given 用户在个人中心
    When 用户选择一个乘客并点击"删除"
    Then 该乘客信息被移除
```

**用户查看订单**
```gherkin
Scenario: 查看未出行订单
    Given 用户在个人中心
    When 用户点击"未出行订单"
    Then 显示所有未完成的订单

Scenario: 查看历史订单
    Given 用户在个人中心
    When 用户点击"历史订单"
    Then 显示所有已完成的订单
```

**用户修改密码**
```gherkin
Scenario: 进入修改密码页面
    Given 用户在个人中心
    When 用户点击"修改密码"
    Then 跳转到修改密码页面，要求输入旧密码、新密码、确认新密码
```

## 3. 非功能性需求

### 3.1 性能需求
- 页面加载时间 ≤ 3秒
- 查询响应时间 ≤ 2秒
- 支持并发用户数 ≥ 1000

### 3.2 安全性需求
- 用户密码加密存储
- 敏感信息传输加密
- 防止SQL注入和XSS攻击
- 实现验证码机制防止暴力破解

### 3.3 兼容性需求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端响应式布局
- 支持iOS和Android系统

### 3.4 可用性需求
- 系统可用性 ≥ 99.9%
- 支持7×24小时运行
- 具备容错和恢复机制

## 4. 技术架构建议

### 4.1 前端技术栈
- React/Vue.js 框架
- Ant Design/Element UI 组件库
- Axios 用于API调用
- Webpack 构建工具

### 4.2 后端技术栈
- Spring Boot/Java 或 Node.js
- MySQL/PostgreSQL 数据库
- Redis 缓存
- Nginx 反向代理

### 4.3 第三方服务
- 短信验证码服务
- 支付接口集成
- 身份证验证接口

## 5. 项目里程碑

### 第一阶段（4周）
- 完成首页和登录注册功能
- 实现基础的车票查询功能

### 第二阶段（4周）
- 完成车次列表和筛选功能
- 实现订单填写和提交功能

### 第三阶段（4周）
- 完成个人中心功能
- 集成支付功能
- 系统测试和优化

## 6. 风险与应对

### 6.1 技术风险
- **风险**：高并发下的系统性能问题
- **应对**：采用分布式架构，使用缓存和负载均衡

### 6.2 业务风险
- **风险**：票务数据的实时性和准确性
- **应对**：与铁路系统对接，确保数据同步

### 6.3 合规风险
- **风险**：用户隐私数据保护
- **应对**：遵循相关法律法规，实施数据加密和访问控制