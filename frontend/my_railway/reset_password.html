<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>重置密码 - 中国铁路12306</title>
  <link rel="stylesheet" href="assets/styles/common.css" />
  <link rel="stylesheet" href="assets/styles/login.css" />
  <style>
    .login-panel{height:auto}
    .login-box{position:relative;left:auto;top:auto;margin:80px auto;width:520px}
    .login-account{padding:20px 30px 25px 30px}
    .login-item{position:static;display:flex;align-items:center;gap:12px;height:auto}
    .login-item .item-label{position:static;width:auto;line-height:30px;white-space:nowrap;color:#333;font-size:16px}
    .login-item .input{padding-left:10px}
    .progress{width:820px;margin:40px auto 0;position:relative}
    .progress .line{position:absolute;top:50%;transform:translateY(-50%);left:14px;right:14px;height:4px;background:#cfe2ff}
    .progress ul{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:repeat(4,1fr);justify-items:center}
    .progress li{position:relative;text-align:center;color:#666;font-size:14px;padding-top:52px}
    .progress .dot{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);width:20px;height:20px;border-radius:50%;background:#fff;border:4px solid #cfe2ff;box-sizing:content-box}
    .progress li.done .dot{background:#3b99fc;border-color:#3b99fc}
    .progress .line{left:12.5%;right:12.5%}
    .progress li.active{color:#2676e3}
    .progress li.active .dot{border-color:#3b99fc;background:#3b99fc}
    .progress li.done{color:#2676e3}
    .progress li.done .dot{border-color:#3b99fc;background:#3b99fc}
  </style>
</head>
<body class="page-login">
  <header class="header">
    <div class="container">
      <div class="header-left">
        <a class="logo" href="index.html">中国铁路12306</a>
      </div>
      <div class="header-right">
        <nav class="nav">
          <a href="index.html">首页</a>
          <a href="tickets.html">购票</a>
          <a href="info.html">信息查询</a>
          <a href="help.html">出行指南</a>
          <a href="register.html">注册</a>
          <a href="login.html">登录</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="content login-panel">
    <div class="progress">
      <div class="line"></div>
      <ul>
        <li class="done"><div class="dot"></div>填写账户信息</li>
        <li class="done"><div class="dot"></div>获取验证码</li>
        <li class="active"><div class="dot"></div>设置新密码</li>
        <li><div class="dot"></div>完成</li>
      </ul>
    </div>
    <div class="login-box" style="width: 500px; margin: 60px auto;">
      <ul class="login-hd">
        <li class="login-hd-code active"><a>设置新密码</a></li>
      </ul>
      <div class="login-account">
        <div class="login-item">
          <span class="item-label">新密码</span>
          <input id="newPassword" class="input" type="password" placeholder="请输入新密码（至少8位，含字母与数字）" />
        </div>
        <div class="login-item">
          <span class="item-label">确认密码</span>
          <input id="confirmPassword" class="input" type="password" placeholder="请再次输入新密码" />
        </div>
        <button id="resetPassword" class="btn-primary w100">提交</button>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-copy">中国铁路12306</div>
    </div>
  </footer>

  <script src="assets/scripts/main.js"></script>
  <script>
    var params = new URLSearchParams(location.search)
    var phone = params.get('phone') || ''
    var code = params.get('code') || '123456'
    document.getElementById('resetPassword').addEventListener('click', function() {
      var newPassword = document.getElementById('newPassword').value;
      var confirmPassword = document.getElementById('confirmPassword').value;
      var strongRe = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/;

      if (!newPassword || !confirmPassword) {
        alert('请输入新密码并确认');
        return;
      }

      if (!strongRe.test(newPassword)) {
        alert('密码需包含字母和数字且至少8位');
        return;
      }

      if (newPassword !== confirmPassword) {
        alert('两次输入的密码不一致');
        return;
      }

      try{
        fetch((window.API_BASE||'http://localhost:5000') + '/auth/reset-password', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone: phone, verificationCode: code, newPassword: newPassword })
        }).then(function(r){ return r.json() }).then(function(res){
          if(res && res.success){
            window.location.href = 'reset_success.html'
          }else{
            alert((res && res.message) || '密码重置失败')
          }
        }).catch(function(){ alert('网络错误') })
      }catch(e){ alert('网络错误') }
    });
  </script>
</body>
</html>
