<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>找回密码 - 中国铁路12306</title>
  <link rel="stylesheet" href="assets/styles/common.css" />
  <link rel="stylesheet" href="assets/styles/login.css" />
  <style>
    .login-panel{height:auto}
    .login-box{position:relative;left:auto;top:auto;margin:80px auto;width:520px}
    .login-account{padding:20px 30px 25px 30px}
    .login-item{position:static;display:flex;align-items:center;gap:12px;height:auto}
    .login-item .item-label{position:static;width:auto;line-height:30px;white-space:nowrap;color:#333;font-size:16px}
    .login-item .input{padding-left:10px}
    .progress{width:820px;margin:40px auto 0;position:relative}
    .progress .line{position:absolute;top:50%;transform:translateY(-50%);left:14px;right:14px;height:4px;background:#cfe2ff}
    .progress ul{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:repeat(4,1fr);justify-items:center}
    .progress li{position:relative;text-align:center;color:#666;font-size:14px;padding-top:52px}
    .progress .dot{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);width:20px;height:20px;border-radius:50%;background:#fff;border:4px solid #cfe2ff;box-sizing:content-box}
    .progress li.done .dot{background:#3b99fc;border-color:#3b99fc}
    .progress .line{left:12.5%;right:12.5%}
    .progress li.active{color:#2676e3}
    .progress li.active .dot{border-color:#3b99fc;background:#3b99fc}
    .progress li.done{color:#2676e3}
    .progress li.done .dot{border-color:#3b99fc;background:#3b99fc}
  </style>
</head>
<body class="page-login">
  <header class="header">
    <div class="container">
      <div class="header-left">
        <a class="logo" href="index.html">中国铁路12306</a>
      </div>
      <div class="header-right">
        <nav class="nav">
          <a href="index.html">首页</a>
          <a href="tickets.html">购票</a>
          <a href="info.html">信息查询</a>
          <a href="help.html">出行指南</a>
          <a href="register.html">注册</a>
          <a href="login.html">登录</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="content login-panel">
    <div class="progress">
      <div class="line"></div>
      <ul>
        <li class="done"><div class="dot"></div>填写账户信息</li>
        <li class="active"><div class="dot"></div>获取验证码</li>
        <li><div class="dot"></div>设置新密码</li>
        <li><div class="dot"></div>完成</li>
      </ul>
    </div>
    <div class="login-box" style="width: 500px; margin: 60px auto;">
      <ul class="login-hd">
        <li class="login-hd-code active"><a>获取验证码</a></li>
      </ul>
      <div class="login-account">
        <div class="login-item" style="flex-wrap:wrap;">
          <span class="item-label">手机号</span>
          <span id="phoneDisplay" class="input" style="border:none;background:transparent"></span>
          <button id="sendCode" class="btn-primary" style="position:relative;z-index:1">获取手机验证码</button>
        </div>
        <div class="login-item">
          <span class="item-label">验证码</span>
          <input id="code" class="input" type="text" placeholder="请输入验证码" style="width: 200px;"/>
        </div>
        <button id="nextStep" class="btn-primary w100">提交</button>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-copy">中国铁路12306</div>
    </div>
  </footer>

  <script src="assets/scripts/main.js"></script>
  <script>
    var p = new URLSearchParams(location.search).get('phone') || ''
    var disp = document.getElementById('phoneDisplay')
    if(disp){ disp.textContent = p ? ('(+86) ' + p) : '' }
    document.getElementById('sendCode').addEventListener('click', function() {
      if(!p){ alert('请返回并填写手机号'); return }
      try{
        fetch((window.API_BASE||'http://localhost:5000') + '/auth/send-code', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone: p, type: 'reset_password' })
        }).then(function(r){ return r.json() }).then(function(res){
          if(res && res.success){
            alert('验证码已发送，请查收！')
            document.getElementById('code').value = '123456'
          }else{
            alert((res && res.message) || '发送验证码失败')
          }
        }).catch(function(){ alert('网络错误') })
      }catch(e){ alert('网络错误') }
    })
    document.getElementById('nextStep').addEventListener('click', function() {
      var code = document.getElementById('code').value
      if (!code) { alert('请输入验证码'); return }
      if (code === '123456') {
        window.location.href = 'reset_password.html?phone=' + encodeURIComponent(p) + '&code=' + encodeURIComponent(code)
      } else {
        alert('验证码错误')
      }
    })
  </script>
</body>
</html>
